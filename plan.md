단계별 구현 계획

  1단계: 추상화 기반 구조 구축

  목표: 기존 _TablePlusRow를 추상화하여 확장 가능한 구조 만들기

  구현할 것:
  - TablePlusRowWidget 추상 클래스 생성
  - _TablePlusRow를 상속으로 변경 (기능 변경 없음)
  - TablePlusBody에서 추상 클래스 사용하도록 수정

  필요한 이유: 기존 코드를 망가뜨리지 않으면서 확장 가능한 기반 마련

  테스트 방법:
  - 기존 example 앱 실행해서 모든 기능 정상 작동 확인
  - 선택, 편집, 정렬 모든 기능이 기존과 동일하게 작동해야 함
  - flutter analyze 통과해야 함

  예상 결과: 기존과 100% 동일한 동작, 단지 내부 구조만 추상화

  아직 안되는 것: 병합 기능 없음 (당연함)

  ---
  2단계: 가장 간단한 병합 구현

  목표: 2개 연속 행을 1개로 병합하는 최소 기능 구현

  구현할 것:
  - _TablePlusMergedRow 클래스 기본 골격
  - 2개 행을 받아서 나란히 표시하는 로직
  - TablePlusBody에 병합 그룹 처리 로직 추가
  - 간단한 MergedRowGroup 설정으로 테스트

  필요한 이유: 복잡한 케이스 전에 기본 동작 검증

  테스트 방법:
  // IT 부서 2명만 간단히 병합
  MergedRowGroup(
    groupId: 'm1',
    originalIndices: [0, 1], // aman, bman
    mergeConfig: {
      'department': MergeCellConfig(shouldMerge: true), // 부서만 병합
    },
  )
  - 부서 칸이 2개 행 높이로 표시되어야 함
  - 이름, 급여는 각자 표시되어야 함
  - ID는 각자 표시되어야 함

  예상 결과:
  ┌────┬──────┬────────────┬────────┐
  │ 1  │ aman │            │   100  │
  ├────┼──────┤    it      ├────────┤
  │ 2  │ bman │            │   300  │
  ├────┼──────┼────────────┼────────┤
  │ 3  │ cman │ business   │   500  │
  └────┴──────┴────────────┴────────┘

  아직 안되는 것:
  - ID 병합 안됨 (다음 단계)
  - 선택 기능과 연동 안됨
  - 복잡한 병합 패턴 안됨

  ---
  3단계: 완전한 병합 패턴 구현

  목표: 사용자가 원하는 정확한 병합 패턴 구현

  구현할 것:
  - ID 병합 (커스텀 컨텐츠 표시)
  - 여러 컬럼 동시 병합
  - spanningRowIndex 로직 구현
  - 사용자 예시와 동일한 결과 구현

  필요한 이유: 실제 사용 가능한 수준의 병합 기능

  테스트 방법:
  MergedRowGroup(
    groupId: 'm1',
    originalIndices: [0, 1],
    mergeConfig: {
      'id': MergeCellConfig(
        shouldMerge: true,
        mergedContent: Text('m1', style: TextStyle(fontWeight: FontWeight.bold)),
      ),
      'department': MergeCellConfig(shouldMerge: true),
    },
  )

  예상 결과: 사용자가 원한 정확한 패턴
  ┌────┬──────┬────────────┬────────┐
  │ ID │ NAME │ Department │ salary │
  ├────┼──────┼────────────┼────────┤
  │    │ aman │            │   100  │
  ├ m1 ┼──────┼    it      ┼────────┤
  │    │ bman │            │   300  │
  ├────┼──────┼────────────┼────────┤
  │ 3  │ cman │ business   │   500  │
  └────┴──────┴────────────┴────────┘

  아직 안되는 것:
  - 선택 시 병합 그룹 단위 선택 안됨
  - 편집 기능과 연동 안됨

  ---
  4단계: 선택 기능 연동

  목표: 병합된 행 선택 시 그룹 단위로 선택/해제

  구현할 것:
  - _TablePlusMergedRow에서 선택 체크박스를 그룹 ID로 처리
  - 선택 상태를 그룹 ID 기준으로 계산
  - 병합된 행 클릭 시 전체 그룹 선택/해제

  필요한 이유: 사용자가 직관적으로 병합된 행을 선택할 수 있어야 함

  테스트 방법:
  - 병합된 행의 체크박스 클릭
  - IT 부서 2명이 동시에 선택되어야 함
  - Select All 동작 확인
  - 개별 행(cman)과 병합 그룹 혼합 선택 확인

  예상 결과: 병합된 행은 하나의 단위로 선택됨

  아직 안되는 것: 편집 기능

  ---
  5단계: 편집 기능 연동

  목표: 병합된 셀과 개별 셀의 편집 구분

  구현할 것:
  - 병합된 셀 편집 시 onMergedCellChanged 콜백 호출
  - 개별 셀 편집 시 기존 onCellChanged 콜백 호출
  - 편집 모드에서 올바른 데이터 인덱스 매핑

  필요한 이유: 병합된 데이터와 개별 데이터를 구분해서 처리해야 함

  테스트 방법:
  - IT 부서 병합된 셀 편집 → onMergedCellChanged('m1', 'department', newValue) 호출되어야 함
  - aman의 이름 편집 → onCellChanged(0, 'name', newValue) 호출되어야 함
  - 편집 후 데이터 상태 확인

  예상 결과: 병합된 셀과 개별 셀의 편집이 구분되어 처리됨

  아직 안되는 것: 없음 (기본 기능 완성)

  ---
  6단계: 성능 최적화 및 엣지 케이스

  목표: 프로덕션 사용 가능한 수준으로 완성

  구현할 것:
  - 대량 데이터에서 성능 테스트
  - 잘못된 originalIndices 처리
  - 중복 그룹 ID 에러 처리
  - 동적 높이 모드에서 병합 행 높이 계산

  필요한 이유: 실제 사용 시 발생할 수 있는 문제들 해결

  테스트 방법:
  - 1000개 행 + 100개 병합 그룹으로 성능 테스트
  - 잘못된 설정으로 에러 핸들링 확인
  - 다양한 테마와 높이 설정에서 테스트

  예상 결과: 안정적이고 빠른 대량 데이터 처리

  완성되는 것: 프로덕션 준비 완료된 병합 테이블 위젯

  ---
  각 단계별 성공 기준

  1. 1단계: flutter analyze 통과 + 기존 기능 100% 동일
  2. 2단계: 간단한 부서 병합 시각적으로 확인 가능
  3. 3단계: 사용자 요구사항과 정확히 일치하는 결과
  4. 4단계: 병합 행 선택이 직관적으로 동작
  5. 5단계: 편집 시 올바른 콜백 호출 확인
  6. 6단계: 대량 데이터에서 렉 없이 동작

  이 계획으로 진행하시겠습니까?